<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="devops k8s python java">
<meta name="keywords" content="devops k8s python java">
<meta property="og:type" content="website">
<meta property="og:title" content="落魄de少爷">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="落魄de少爷">
<meta property="og:description" content="devops k8s python java">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>落魄de少爷</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">落魄de少爷</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">运维狗</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/03/hexo%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2for-Mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/03/hexo%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2for-Mac/" itemprop="url">hexo环境部署for Mac</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-03T15:11:02+08:00">
                2019-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>brew install nodejs<br>brew install git<br>npm install -g hexo-cli<br>hexo init blog<br>cd blog<br>npm install<br>npm i hexo-deployer-git</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/03/zjl-%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/03/zjl-%E6%B5%8B%E8%AF%95/" itemprop="url">zjl 测试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-03T11:15:12+08:00">
                2019-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/28/zjl-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/28/zjl-blog/" itemprop="url">zjl blog</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-28T18:29:21+08:00">
                2019-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">测试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/28/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/28/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-28T17:21:52+08:00">
                2019-10-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/07/cdh6_install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/07/cdh6_install/" itemprop="url">Cdh6_install</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-07T13:45:13+08:00">
                2019-04-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://archive.cloudera.com/cm6/6.2.0/" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/</a></p>
<p><a href="https://archive.cloudera.com/cm6/6.2.0/cloudera-manager-installer.bin" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/cloudera-manager-installer.bin</a></p>
<p>mkdir /softwares</p>
<p>cd /softwares &amp;&amp; wget <a href="https://archive.cloudera.com/cm6/6.2.0/cloudera-manager-installer.bin" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/cloudera-manager-installer.bin</a></p>
<p>chmod 777 cloudera-manager-installer.bin</p>
<p>./cloudera-manager-installer.bin —skip_repo_package=1</p>
<p>cd /softwares</p>
<p>wget <a href="https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm</a></p>
<p>rpm -ivh oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm</p>
<p>wget <a href="https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/cloudera-manager-server-6.2.0-968826.el7.x86_64.rpm" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/cloudera-manager-server-6.2.0-968826.el7.x86_64.rpm</a></p>
<p>wget <a href="https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/cloudera-manager-daemons-6.2.0-968826.el7.x86_64.rpm" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/cloudera-manager-daemons-6.2.0-968826.el7.x86_64.rpm</a></p>
<p>wget <a href="https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/cloudera-manager-server-db-2-6.2.0-968826.el7.x86_64.rpm" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.2.0/redhat7/yum/RPMS/x86_64/cloudera-manager-server-db-2-6.2.0-968826.el7.x86_64.rpm</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/19/salt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/19/salt/" itemprop="url">Salt</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-19T07:30:14+08:00">
                2019-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/08/elk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/08/elk/" itemprop="url">Elk</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-08T07:56:07+08:00">
                2019-03-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第-1-节：elk讲解框架和java1-8环境搭建"><a href="#第-1-节：elk讲解框架和java1-8环境搭建" class="headerlink" title="第 1 节：elk讲解框架和java1.8环境搭建"></a>第 1 节：elk讲解框架和java1.8环境搭建</h2><h2 id="第-2-节：kibana的安装和启动"><a href="#第-2-节：kibana的安装和启动" class="headerlink" title="第 2 节：kibana的安装和启动"></a>第 2 节：kibana的安装和启动</h2><h3 id="2-1-kibana-下载地址（kibana主要用来展示数据，它本身不存储数据"><a href="#2-1-kibana-下载地址（kibana主要用来展示数据，它本身不存储数据" class="headerlink" title="2.1 kibana 下载地址（kibana主要用来展示数据，它本身不存储数据)"></a>2.1 kibana 下载地址（kibana主要用来展示数据，它本身不存储数据)</h3><p>​       <a href="https://artifacts.elastic.co/downloads/kibana/kibana-6.6.1-linux-x86_64.tar.gz" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/kibana/kibana-6.6.1-linux-x86_64.tar.gz</a></p>
<h3 id="2-2-准备工作，添加-elk-用户-用-elk用户来启动-elk"><a href="#2-2-准备工作，添加-elk-用户-用-elk用户来启动-elk" class="headerlink" title="2.2 准备工作，添加 elk 用户, 用 elk用户来启动 elk"></a>2.2 准备工作，添加 elk 用户, 用 elk用户来启动 elk</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin elk #不让elk用户登陆系统</span><br><span class="line">tar zxvf kibana-6.6.1-linux-x86_64.tar.gz</span><br><span class="line">mv kibana-6.6.1-linux-x86_64 /opt/kibana-6.6.1</span><br></pre></td></tr></table></figure>

<h3 id="2-3-kibana配置文件"><a href="#2-3-kibana配置文件" class="headerlink" title="2.3 kibana配置文件"></a>2.3 kibana配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i "s/#server.port: 5601/server.port: 5601/g" /opt/kibana-6.6.1/config/kibana.yml</span><br><span class="line">sed -i "s/#server.host: \"localhost\"/server.host: \"0.0.0.0\"/g" /opt/kibana-6.6.1/config/kibana.yml</span><br><span class="line">sed -i "s/#elasticsearch.hosts: \[\"http:\/\/localhost:9200\"\]/elasticsearch.hosts: \[\"http:\/\/172.16.102.23:9200\"\]/g" /opt/kibana-6.6.1/config/kibana.yml</span><br></pre></td></tr></table></figure>

<h3 id="2-4-把-kibana-目录改为-elk-用户"><a href="#2-4-把-kibana-目录改为-elk-用户" class="headerlink" title="2.4 把 kibana 目录改为 elk 用户"></a>2.4 把 kibana 目录改为 elk 用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R elk:elk /opt/kibana-6.6.1</span><br></pre></td></tr></table></figure>

<h3 id="2-5-新增启动脚本-start-sh"><a href="#2-5-新增启动脚本-start-sh" class="headerlink" title="2.5 新增启动脚本 start.sh"></a>2.5 新增启动脚本 start.sh</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;/opt/kibana-6.6.1/bin/start.sh</span><br><span class="line">nohup /opt/kibana-6.6.1/bin/kibana &gt;&gt;/tmp/kibana.log 2&gt;&gt;/tmp/kibana.log &amp;</span><br><span class="line">EOF</span><br><span class="line">chmod a+x /opt/kibana-6.6.1/bin/start.sh</span><br></pre></td></tr></table></figure>

<h3 id="2-6-用普通用户启动"><a href="#2-6-用普通用户启动" class="headerlink" title="2.6 用普通用户启动"></a>2.6 用普通用户启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/bash elk '/opt/kibana-6.6.1/bin/start.sh'</span><br></pre></td></tr></table></figure>



<h2 id="第-3-节：使用nginx来限制访问kibana"><a href="#第-3-节：使用nginx来限制访问kibana" class="headerlink" title="第 3 节：使用nginx来限制访问kibana"></a>第 3 节：使用nginx来限制访问kibana</h2><h2 id="第-4-节：elasticsearch的安装和启动"><a href="#第-4-节：elasticsearch的安装和启动" class="headerlink" title="第 4 节：elasticsearch的安装和启动"></a>第 4 节：elasticsearch的安装和启动</h2><h3 id="4-1-elasticsearch-下载地址（elasticsearch主要用来存储数据，供kibana调取并进行展示）"><a href="#4-1-elasticsearch-下载地址（elasticsearch主要用来存储数据，供kibana调取并进行展示）" class="headerlink" title="4.1 elasticsearch 下载地址（elasticsearch主要用来存储数据，供kibana调取并进行展示）"></a>4.1 elasticsearch 下载地址（elasticsearch主要用来存储数据，供kibana调取并进行展示）</h3><p><a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.1.tar.gz" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.1.tar.gz</a></p>
<h3 id="4-2-elasticsearch-配置"><a href="#4-2-elasticsearch-配置" class="headerlink" title="4.2 elasticsearch 配置"></a>4.2 elasticsearch 配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/elasticsearch-6.6.1/data</span><br><span class="line">sed -i "s/#path.data: \/path\/to\/data/path.data: \/opt\/elasticsearch-6.6.1\/data/g" /opt/elasticsearch-6.6.1/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">sed -i "s/#path.logs: \/path\/to\/logs/path.logs: \/opt\/elasticsearch-6.6.1\/logs/g" /opt/elasticsearch-6.6.1/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">sed -i "s/#network.host: 192.168.0.1/network.host: 0.0.0.0/g" /opt/elasticsearch-6.6.1/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">sed -i "s/#http.port: 9200/http.port: 9200/g" /opt/elasticsearch-6.6.1/config/elasticsearch.yml</span><br></pre></td></tr></table></figure>

<h3 id="4-3-把-elasticsearch-目录的用户和属主改为elk"><a href="#4-3-把-elasticsearch-目录的用户和属主改为elk" class="headerlink" title="4.3 把 elasticsearch 目录的用户和属主改为elk"></a>4.3 把 elasticsearch 目录的用户和属主改为elk</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R elk:elk /opt/elasticsearch-6.6.1</span><br></pre></td></tr></table></figure>

<h3 id="4-4-更改-jvm-的内存限制（看个人配置）"><a href="#4-4-更改-jvm-的内存限制（看个人配置）" class="headerlink" title="4.4 更改 jvm 的内存限制（看个人配置）"></a>4.4 更改 jvm 的内存限制（看个人配置）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i "s/-Xms1g/-Xms16g/g" /opt/elasticsearch-6.6.1/config/jvm.options</span><br><span class="line">sed -i "s/-Xmx1g/-Xmx16g/g" /opt/elasticsearch-6.6.1/config/jvm.options</span><br></pre></td></tr></table></figure>

<h3 id="4-5-elasticsearch-启动脚本，使用-d-进行后台启动"><a href="#4-5-elasticsearch-启动脚本，使用-d-进行后台启动" class="headerlink" title="4.5 elasticsearch 启动脚本，使用 -d 进行后台启动"></a>4.5 elasticsearch 启动脚本，使用 -d 进行后台启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;/opt/elasticsearch-6.6.1/bin/start.sh</span><br><span class="line">/opt/elasticsearch-6.6.1/bin/elasticsearch -d &gt;&gt;/tmp/elasticsearch.log 2&gt;&gt;/tmp/elasticsearch.log</span><br><span class="line">EOF</span><br><span class="line">chmod a+x /opt/elasticsearch-6.6.1/bin/start.sh</span><br><span class="line"></span><br><span class="line">sed -i "s/#DefaultLimitNOFILE=/DefaultLimitNOFILE=1024000/g" /etc/systemd/system.conf (需要重启)</span><br><span class="line">sed -i "s/#DefaultLimitNPROC=/DefaultLimitNPROC=1024000/g" /etc/systemd/system.conf (需要重启)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">[1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span></span><br><span class="line"></span><br><span class="line">sysctl -w vm.max_map_count=262144</span><br><span class="line">echo "vm.max_map_count=262144" &gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="4-6-启动-elasticsearch"><a href="#4-6-启动-elasticsearch" class="headerlink" title="4.6 启动 elasticsearch"></a>4.6 启动 elasticsearch</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/bash elk '/opt/elasticsearch-6.6.1/bin/start.sh'</span><br></pre></td></tr></table></figure>

<h3 id="4-7-elasticsearch-监听在非-127-0-0-1-，需要配置内核参数等"><a href="#4-7-elasticsearch-监听在非-127-0-0-1-，需要配置内核参数等" class="headerlink" title="4.7 elasticsearch 监听在非 127.0.0.1 ，需要配置内核参数等"></a>4.7 elasticsearch 监听在非 127.0.0.1 ，需要配置内核参数等</h3><h2 id="第-5-节：logstash的安装和启动"><a href="#第-5-节：logstash的安装和启动" class="headerlink" title="第 5 节：logstash的安装和启动"></a>第 5 节：logstash的安装和启动</h2><h3 id="5-1-logstash-的下载地址（用来读取日志，正则分析日志，发送给-elasticsearch-数据库）"><a href="#5-1-logstash-的下载地址（用来读取日志，正则分析日志，发送给-elasticsearch-数据库）" class="headerlink" title="5.1 logstash 的下载地址（用来读取日志，正则分析日志，发送给 elasticsearch 数据库）"></a>5.1 logstash 的下载地址（用来读取日志，正则分析日志，发送给 elasticsearch 数据库）</h3><p><a href="https://artifacts.elastic.co/downloads/logstash/logstash-6.6.1.tar.gz" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/logstash/logstash-6.6.1.tar.gz</a></p>
<h3 id="5-2-更改-logstash-jvm-配置"><a href="#5-2-更改-logstash-jvm-配置" class="headerlink" title="5.2 更改 logstash jvm 配置"></a>5.2 更改 logstash jvm 配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i "s/-Xms1g/-Xms4g/g" /opt/logstash-6.6.1/config/jvm.options</span><br><span class="line">sed -i "s/-Xmx1g/-Xmx4g/g" /opt/logstash-6.6.1/config/jvm.options</span><br></pre></td></tr></table></figure>

<h3 id="5-3-logstash配置"><a href="#5-3-logstash配置" class="headerlink" title="5.3 logstash配置"></a>5.3 logstash配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/logstash-6.6.1/conf.d </span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt;/opt/logstash-6.6.1/conf.d/first_pipelines.yml</span><br><span class="line">input &#123;</span><br><span class="line">    stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2019-03-11 11:00:55.725  INFO 22399 --- [2-30010-exec-64] com.ittx.cbt.util.SequenceGenerator      : Sequence Generator next response from redis: [wms][transaction_history]: [6879747]</span><br><span class="line">&#123;</span><br><span class="line">      "@version" =&gt; "1",</span><br><span class="line">          "host" =&gt; "logstash",</span><br><span class="line">       "message" =&gt; "2019-03-11 11:00:55.725  INFO 22399 --- [2-30010-exec-64] com.ittx.cbt.util.SequenceGenerator      : Sequence Generator next response from redis: [wms][transaction_history]: [6879747]",</span><br><span class="line">    "@timestamp" =&gt; 2019-03-11T05:31:12.496Z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取 message 里面的 时间字段</span></span><br><span class="line">input &#123;</span><br><span class="line">    stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">        match =&gt; &#123;</span><br><span class="line">            "message" =&gt; '(?&lt;mydate&gt;[a-zA-Z]+ [0-9]+ [0-9]+:[0-9]+:[0-9]+).*'</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Mar 11 14:45:01 logstash CROND[10325]: (root) CMD (/usr/sbin/ntpdate ntp.api.bz)</span><br><span class="line">&#123;</span><br><span class="line">        "mydate" =&gt; "Mar 11 14:45:01",</span><br><span class="line">       "message" =&gt; "Mar 11 14:45:01 logstash CROND[10325]: (root) CMD (/usr/sbin/ntpdate ntp.api.bz)",</span><br><span class="line">          "host" =&gt; "logstash",</span><br><span class="line">      "@version" =&gt; "1",</span><br><span class="line">    "@timestamp" =&gt; 2019-03-11T07:00:43.500Z</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-4-logstash-启动文件"><a href="#5-4-logstash-启动文件" class="headerlink" title="5.4 logstash 启动文件"></a>5.4 logstash 启动文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;/opt/logstash-6.6.1/bin/start.sh</span><br><span class="line">nohup /opt/logstash-6.6.1/bin/logstash -f /opt/logstash-6.6.1/conf.d/ &gt;&gt;/tmp/logstash.log 2&gt;&gt;/tmp/logstash.log &amp;</span><br><span class="line">EOF</span><br><span class="line">chmod a+x /opt/logstash-6.6.1/bin/start.sh</span><br></pre></td></tr></table></figure>



<h2 id="第-6-节：logstash正则提取系统日志和tomcat日志"><a href="#第-6-节：logstash正则提取系统日志和tomcat日志" class="headerlink" title="第 6 节：logstash正则提取系统日志和tomcat日志"></a>第 6 节：logstash正则提取系统日志和tomcat日志</h2><p>logstash如果直接把一整行日志直接发送给elasticsearch，kibana显示出来就没有什么意义，我们需要提取自己想要的字段。假如说我们想要提取响应码，用户访问url，响应时间等，就得依靠正则来提取。</p>
<h3 id="6-1-logstash最简单配置，输入什么，就输出什么，方便我们测试正则表达式"><a href="#6-1-logstash最简单配置，输入什么，就输出什么，方便我们测试正则表达式" class="headerlink" title="6.1 logstash最简单配置，输入什么，就输出什么，方便我们测试正则表达式"></a>6.1 logstash最简单配置，输入什么，就输出什么，方便我们测试正则表达式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123;</span><br><span class="line">        code=&gt;gogogodebug</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">直接运行进行测试</span></span><br><span class="line">/opt/logstash-6.6.1/bin/logstash -f /opt/logstash-6.6.1/config/logstash.yml</span><br><span class="line">输入Apr 15 08:16:17 guest crond[449]: (CRON) INFO (running with inotify support)会原样输出</span><br></pre></td></tr></table></figure>

<h3 id="6-2-提取cron日志，logtash支持扩展正则"><a href="#6-2-提取cron日志，logtash支持扩展正则" class="headerlink" title="6.2 提取cron日志，logtash支持扩展正则"></a>6.2 提取cron日志，logtash支持扩展正则</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">输入日志：</span><br><span class="line">10.251.254.211 - - [16/Mar/2018:15:44:04 +0800] "GET /test HTTP/1.1" 404 1078</span><br><span class="line">input &#123;</span><br><span class="line">    stdin &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">        match =&gt; &#123;</span><br><span class="line">            "message" =&gt; '(?&lt;myip&gt;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;) - - \[(?&lt;mydate&gt;[^ ]+) \+\d+\] "(?&lt;mymethod&gt;[A-Z]+) (?&lt;myurl&gt;[^ ]+) HTTP/\d.\d" (?&lt;myresponsecode&gt;[0-9]+) (?&lt;myresponsesize&gt;[0-9]+)'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123;</span><br><span class="line">        code=&gt;gogogodebug</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取时间</span></span><br><span class="line">"message" =&gt; '(?&lt;mydate&gt;[a-zA-Z]+ [0-9]+ [0-9]+:[0-9]+:[0-9]+) .*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取时间+主机名</span></span><br><span class="line">"message" =&gt; '(?&lt;mydate&gt;[a-zA-Z]+ [0-9]+ [0-9]+:[0-9]+:[0-9]+) (?&lt;myhostname&gt;[^ ]+) .*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取时间+主机名+运行用户</span></span><br><span class="line">"message" =&gt; '(?&lt;mydate&gt;[a-zA-Z]+ [0-9]+ [0-9]+:[0-9]+:[0-9]+) (?&lt;myhostname&gt;[^ ]+) CROND\[[0-9]+\]: \((?&lt;myuser&gt;[0-9a-zA-Z]+)\) .*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取时间+主机名+运行用户+运行命令</span></span><br><span class="line">"message" =&gt; '(?&lt;mydate&gt;[a-zA-Z]+ [0-9]+ [0-9]+:[0-9]+:[0-9]+) (?&lt;myhostname&gt;[^ ]+) CROND\[[0-9]+\]: \((?&lt;myuser&gt;[0-9a-zA-Z-]+)\) CMD \((?&lt;mycommand&gt;.*)\)'</span><br></pre></td></tr></table></figure>

<h3 id="6-3-tomcat日志提取"><a href="#6-3-tomcat日志提取" class="headerlink" title="6.3 tomcat日志提取"></a>6.3 tomcat日志提取</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">10.251.254.211 - - [16/Mar/2018:15:44:04 +0800] "GET /test HTTP/1.1" 404 1078</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取ip</span></span><br><span class="line">"message" =&gt; '(?&lt;myip&gt;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;) - - .*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取ip+时间</span></span><br><span class="line">"message" =&gt; '(?&lt;myip&gt;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;) - - \[(?&lt;mydate&gt;[^ ]+) \+\d+\] ".*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取ip+时间+请求方法</span></span><br><span class="line">"message" =&gt; '(?&lt;myip&gt;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;) - - \[(?&lt;mydate&gt;[^ ]+) \+\d+\] "(?&lt;mymethod&gt;[A-Z]+) .*'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">提取ip+时间+请求方法+url+response code+响应大小</span></span><br><span class="line">"message" =&gt; '(?&lt;myip&gt;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;) - - \[(?&lt;mydate&gt;[^ ]+) \+\d+\] "(?&lt;mymethod&gt;[A-Z]+) (?&lt;myurl&gt;[^ ]+) HTTP/\d.\d" (?&lt;myresponsecode&gt;[0-9]+) (?&lt;myresponsesize&gt;[0-9]+)'</span><br></pre></td></tr></table></figure>

<h3 id="6-4-正则匹配出错就不输出"><a href="#6-4-正则匹配出错就不输出" class="headerlink" title="6.4 正则匹配出错就不输出"></a>6.4 正则匹配出错就不输出</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">    if "_grokparsefailure" not in [tags] and "_dateparsefailure" not in [tags] &#123;</span><br><span class="line">        stdout &#123;</span><br><span class="line">            codec=&gt;rubydebug</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第-7-节：elk技术全量分析nginx日志"><a href="#第-7-节：elk技术全量分析nginx日志" class="headerlink" title="第 7 节：elk技术全量分析nginx日志"></a>第 7 节：elk技术全量分析nginx日志</h2><h2 id="第-8-节：filebeat的安装与启动"><a href="#第-8-节：filebeat的安装与启动" class="headerlink" title="第 8 节：filebeat的安装与启动"></a>第 8 节：filebeat的安装与启动</h2><p>从之前的实践观察下logstash的启动，logstash依赖于java环境，比较重，如果每台客户端都部署的话相对麻烦。因此引进了filebeat，filebeat不依赖于java，轻量，易部署。</p>
<h3 id="8-1-filebeat-下载地址"><a href="#8-1-filebeat-下载地址" class="headerlink" title="8.1 filebeat 下载地址"></a>8.1 filebeat 下载地址</h3><p><a href="https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.6.1-linux-x86_64.tar.gz" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.6.1-linux-x86_64.tar.gz</a></p>
<h3 id="8-2-filebeat-配置文件"><a href="#8-2-filebeat-配置文件" class="headerlink" title="8.2 filebeat 配置文件"></a>8.2 filebeat 配置文件</h3><h3 id="8-3-启动-filebeat"><a href="#8-3-启动-filebeat" class="headerlink" title="8.3 启动 filebeat"></a>8.3 启动 filebeat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;/opt/filebeat-6.6.1/start.sh</span><br><span class="line">nohup /opt/filebeat-6.6.1/filebeat -e -c /opt/filebeat-6.6.1/filebeat.yml &gt;&gt;/tmp/filebeat.log 2&gt;&gt;/tmp/filebeat.log &amp;</span><br><span class="line">EOF</span><br><span class="line">chmod a+x /opt/filebeat-6.6.1/start.sh</span><br></pre></td></tr></table></figure>



<h2 id="第-9-节：logstash结合filebeat进行日志收集"><a href="#第-9-节：logstash结合filebeat进行日志收集" class="headerlink" title="第 9 节：logstash结合filebeat进行日志收集"></a>第 9 节：logstash结合filebeat进行日志收集</h2><h2 id="第-10-节：在filebeat和logstash中引入redis"><a href="#第-10-节：在filebeat和logstash中引入redis" class="headerlink" title="第 10 节：在filebeat和logstash中引入redis"></a>第 10 节：在filebeat和logstash中引入redis</h2><h2 id="第-11-节：索引自定义和kibana简单图表使用"><a href="#第-11-节：索引自定义和kibana简单图表使用" class="headerlink" title="第 11 节：索引自定义和kibana简单图表使用"></a>第 11 节：索引自定义和kibana简单图表使用</h2><h2 id="第-12-节：Logstash使用判断分析多个日志"><a href="#第-12-节：Logstash使用判断分析多个日志" class="headerlink" title="第 12 节：Logstash使用判断分析多个日志"></a>第 12 节：Logstash使用判断分析多个日志</h2><h2 id="第-13-节：多种时间格式覆盖timestamp"><a href="#第-13-节：多种时间格式覆盖timestamp" class="headerlink" title="第 13 节：多种时间格式覆盖timestamp"></a>第 13 节：多种时间格式覆盖timestamp</h2><h2 id="第-14-节：Logstash解析Json格式的日志"><a href="#第-14-节：Logstash解析Json格式的日志" class="headerlink" title="第 14 节：Logstash解析Json格式的日志"></a>第 14 节：Logstash解析Json格式的日志</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/08/kubernetes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/08/kubernetes/" itemprop="url">Kubernetes</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-08T04:16:42+08:00">
                2019-03-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="第-1-章-Kubernetes-概述"><a href="#第-1-章-Kubernetes-概述" class="headerlink" title="第 1 章 Kubernetes 概述"></a>第 1 章 Kubernetes 概述</h1><h2 id="1-1-kubernetes值的学习吗？"><a href="#1-1-kubernetes值的学习吗？" class="headerlink" title="1.1 kubernetes值的学习吗？"></a>1.1 kubernetes值的学习吗？</h2><h1 id="第-2-章-Kubernetes-生产级高可用集群部署"><a href="#第-2-章-Kubernetes-生产级高可用集群部署" class="headerlink" title="第 2 章 Kubernetes 生产级高可用集群部署"></a>第 2 章 Kubernetes 生产级高可用集群部署</h1><h2 id="2-1-kubernetes部署方式与平台规划"><a href="#2-1-kubernetes部署方式与平台规划" class="headerlink" title="2.1 kubernetes部署方式与平台规划"></a>2.1 kubernetes部署方式与平台规划</h2><h2 id="2-2-自签-Etcd-SSL-证书"><a href="#2-2-自签-Etcd-SSL-证书" class="headerlink" title="2.2 自签 Etcd SSL 证书"></a>2.2 自签 Etcd SSL 证书</h2><h2 id="2-3-Etcd-数据库集群部署"><a href="#2-3-Etcd-数据库集群部署" class="headerlink" title="2.3 Etcd 数据库集群部署"></a>2.3 Etcd 数据库集群部署</h2><h2 id="2-4-Node-安装-Docker"><a href="#2-4-Node-安装-Docker" class="headerlink" title="2.4 Node 安装 Docker"></a>2.4 Node 安装 Docker</h2><h2 id="2-5-Flannel-网络工作原理"><a href="#2-5-Flannel-网络工作原理" class="headerlink" title="2.5 Flannel 网络工作原理"></a>2.5 Flannel 网络工作原理</h2><h2 id="2-6-Flannel-容器集群网络部署"><a href="#2-6-Flannel-容器集群网络部署" class="headerlink" title="2.6 Flannel 容器集群网络部署"></a>2.6 Flannel 容器集群网络部署</h2><h2 id="2-7-自签-APIServer-SSL-证书"><a href="#2-7-自签-APIServer-SSL-证书" class="headerlink" title="2.7 自签 APIServer SSL 证书"></a>2.7 自签 APIServer SSL 证书</h2><h2 id="2-8-单-Master-集群-部署-Master01-组件"><a href="#2-8-单-Master-集群-部署-Master01-组件" class="headerlink" title="2.8 单 Master 集群-部署 Master01 组件"></a>2.8 单 Master 集群-部署 Master01 组件</h2><h2 id="2-9-单-Master-集群-生成-Node-kubeconfig-文件"><a href="#2-9-单-Master-集群-生成-Node-kubeconfig-文件" class="headerlink" title="2.9 单 Master 集群-生成 Node kubeconfig 文件"></a>2.9 单 Master 集群-生成 Node kubeconfig 文件</h2><h2 id="2-10-单-Master-集群-部署-Node-组件"><a href="#2-10-单-Master-集群-部署-Node-组件" class="headerlink" title="2.10 单 Master 集群-部署 Node 组件"></a>2.10 单 Master 集群-部署 Node 组件</h2><h2 id="2-11-运行一个测试示例检验集群工作状态"><a href="#2-11-运行一个测试示例检验集群工作状态" class="headerlink" title="2.11 运行一个测试示例检验集群工作状态"></a>2.11 运行一个测试示例检验集群工作状态</h2><h2 id="2-12-部署-Web-UI-Dashboard"><a href="#2-12-部署-Web-UI-Dashboard" class="headerlink" title="2.12 部署 Web UI (Dashboard)"></a>2.12 部署 Web UI (Dashboard)</h2><h2 id="2-13-多-Master-集群-部署-Master02-组件"><a href="#2-13-多-Master-集群-部署-Master02-组件" class="headerlink" title="2.13 多 Master 集群-部署 Master02 组件"></a>2.13 多 Master 集群-部署 Master02 组件</h2><h2 id="2-14-多-Master-集群-Nginx-Keepalived-高可用"><a href="#2-14-多-Master-集群-Nginx-Keepalived-高可用" class="headerlink" title="2.14 多 Master 集群-Nginx+Keepalived (高可用)"></a>2.14 多 Master 集群-Nginx+Keepalived (高可用)</h2><h1 id="第-3-章-kubectl-命令行管理工具"><a href="#第-3-章-kubectl-命令行管理工具" class="headerlink" title="第 3 章 kubectl 命令行管理工具"></a>第 3 章 kubectl 命令行管理工具</h1><h1 id="第-4-章-YAML文件（资源编排）"><a href="#第-4-章-YAML文件（资源编排）" class="headerlink" title="第 4 章 YAML文件（资源编排）"></a>第 4 章 YAML文件（资源编排）</h1><h1 id="第-5-章-深入理解Pod对象"><a href="#第-5-章-深入理解Pod对象" class="headerlink" title="第 5 章 深入理解Pod对象"></a>第 5 章 深入理解Pod对象</h1><h1 id="第-6-章-深入理解Service（与外界连通）"><a href="#第-6-章-深入理解Service（与外界连通）" class="headerlink" title="第 6 章 深入理解Service（与外界连通）"></a>第 6 章 深入理解Service（与外界连通）</h1><h1 id="第-7-章-Ingress（暴露应用对外访问的最佳方式）"><a href="#第-7-章-Ingress（暴露应用对外访问的最佳方式）" class="headerlink" title="第 7 章 Ingress（暴露应用对外访问的最佳方式）"></a>第 7 章 Ingress（暴露应用对外访问的最佳方式）</h1><h1 id="第-8-章-Volume（数据卷）"><a href="#第-8-章-Volume（数据卷）" class="headerlink" title="第 8 章 Volume（数据卷）"></a>第 8 章 Volume（数据卷）</h1><h1 id="第-9-章-企业应用案例"><a href="#第-9-章-企业应用案例" class="headerlink" title="第 9 章 企业应用案例"></a>第 9 章 企业应用案例</h1><h1 id="第-10-章-Kubernetes集群资源监控"><a href="#第-10-章-Kubernetes集群资源监控" class="headerlink" title="第 10 章 Kubernetes集群资源监控"></a>第 10 章 Kubernetes集群资源监控</h1><h1 id="第-11-章-Kubernetes平台中日志收集并可视化展示"><a href="#第-11-章-Kubernetes平台中日志收集并可视化展示" class="headerlink" title="第 11 章 Kubernetes平台中日志收集并可视化展示"></a>第 11 章 Kubernetes平台中日志收集并可视化展示</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/04/blackbox_exporter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/04/blackbox_exporter/" itemprop="url">Blackbox_exporter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T02:42:36+08:00">
                2019-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/01/redis_install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhouJinliang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="落魄de少爷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/01/redis_install/" itemprop="url">Redis_install</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-01T04:44:38+08:00">
                2019-03-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="CentOS7-生产环境安装-redis"><a href="#CentOS7-生产环境安装-redis" class="headerlink" title="CentOS7 生产环境安装 redis  "></a><strong>CentOS7 生产环境安装 redis</strong>  </h2><p>软件版本: redis-4.0.11<br>下载地址：<a href="http://download.redis.io/releases/redis-4.0.11.tar.gz" target="_blank" rel="noopener">http://download.redis.io/releases/redis-4.0.11.tar.gz</a><br>操作系统：<br>硬件配置：  </p>
<h2 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a><strong>系统优化</strong></h2><p><strong>关闭 NetworkManager</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# systemctl stop NetworkManager</span><br><span class="line">[root@ecs-a073 ~]# systemctl disable NetworkManager</span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/NetworkManager.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.freedesktop.NetworkManager.service.</span><br></pre></td></tr></table></figure>
<p><strong>设置与内存相关的内存参数</strong><br>Redis中不需要使用与数据集大小相同的空闲内存。但是Linux在默认情况下可能会检查是否有足够的空闲内存来复制父进程的所有内存页，可能导致Out of Memory而崩溃。所以要将overcommit设为1，表示当一个程序调用诸如malloc（）等函数分配内存时，即使系统没有足够的内存空间函数也会执行成功。</p>
<p>swappiness参数值越大，内核进行内存交换越激进。</p>
<p>启用虚拟内存后，redis会尝试访问磁盘上的虚拟内存。会导致redis被磁盘I/O阻塞。redis我们要发挥他的高速处理能力，所以设置成swappiness=0禁用交换分区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# sysctl -w vm.overcommit_memory=1</span><br><span class="line">vm.overcommit_memory = 1</span><br><span class="line">[root@ecs-a073 ~]# sysctl -w vm.swappiness=0</span><br><span class="line">vm.swappiness = 0</span><br></pre></td></tr></table></figure>
<p><strong>持久化保存这些参数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# echo “vm.overcommit_memory=1” &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@ecs-a073 ~]# echo “vm.swappiness=0” &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p><strong>检查参数是否已被设置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# sysctl vm.overcommit_memory vm.swappiness</span><br><span class="line">vm.overcommit_memory = 1</span><br><span class="line">vm.swappiness = 0</span><br></pre></td></tr></table></figure>
<p><strong>禁止透明大页功能</strong><br>使用透明大页功能会导致持久化的子进程创建缓慢，所以禁用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">[root@ecs-a073 ~]# echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br></pre></td></tr></table></figure>
<p><strong>持久化保存这些设置</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# cat &gt;&gt; /etc/rc.local &lt;&lt; EOF</span><br><span class="line">&gt; echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">&gt; echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>
<p><strong>检查参数是否已被设置</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">always madvise [never]</span><br><span class="line">[root@ecs-a073 ~]# cat /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">always madvise [never]</span><br></pre></td></tr></table></figure>
<p><strong>网络优化，设置与网络相关的内核参数</strong><br>默认的2个参数是128.设置大一点可以优化TCP连接  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# sysctl -w net.core.somaxconn=65535</span><br><span class="line">net.core.somaxconn = 65535</span><br><span class="line">[root@ecs-a073 ~]# sysctl -w net.ipv4.tcp_max_syn_backlog=65535</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 65535</span><br></pre></td></tr></table></figure>
<p><strong>持久化保存参数</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# echo “net.core.somaxconn=65535” &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@ecs-a073 ~]# echo “net.ipv4.tcp_max_syn_backlog=65535” &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p><strong>检查参数是否已被设置</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# sysctl net.core.somaxconn net.ipv4.tcp_max_syn_backlog</span><br><span class="line">net.core.somaxconn = 65535</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 65535</span><br></pre></td></tr></table></figure>
<p><strong>开启SYN Cookies</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# echo “net.ipv4.tcp_syncookies = 1” &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p><strong>定时矫正服务器时间</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# ntpdate ntp.api.bz</span><br><span class="line">25 Oct 16:13:55 ntpdate[4304]: step time server 182.92.12.11 offset 0.995419 sec</span><br><span class="line">[root@ecs-a073 ~]# crontab -e</span><br><span class="line">// 加入一行</span><br><span class="line">*/5 * * * * /usr/sbin/ntpdate ntp.api.bz</span><br></pre></td></tr></table></figure>
<p><strong>调整Linux的最大文件打开数</strong>  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# vim /etc/systemd/system.conf</span><br><span class="line">// 修改成下面的参数</span><br><span class="line">DefaultLimitNOFILE=1024000</span><br><span class="line">DefaultLimitNPROC=1024000 (注意 重启才能生效)</span><br><span class="line">[root@ecs-a073 ~]# ulimit -a</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">重启后查看：</span><br><span class="line">open files                      (-n) 1024000</span><br></pre></td></tr></table></figure>
<h2 id="安装-Redis"><a href="#安装-Redis" class="headerlink" title="安装 Redis"></a><strong>安装 Redis</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 opt]# cd /opt/</span><br><span class="line">[root@ecs-a073 opt]# wget http://download.redis.io/releases/redis-4.0.11.tar.gz</span><br><span class="line">[root@ecs-a073 opt]# tar zxvf redis-4.0.11.tar.gz</span><br><span class="line">[root@ecs-a073 opt]# mv redis-4.0.11 redis</span><br><span class="line">[root@ecs-a073 opt]# cd redis/</span><br><span class="line">yum install gcc</span><br><span class="line">cd deps</span><br><span class="line">make hiredis jemalloc linenoise lua</span><br><span class="line">[root@ecs-a073 redis]# make MALLOC=libc</span><br><span class="line">[root@ecs-a073 redis]# make install (这步骤其实是就是在/usr/local/bin下产生二进制文件)</span><br><span class="line">[root@ecs-a073 bin]# pwd</span><br><span class="line">/usr/local/bin</span><br><span class="line">[root@ecs-a073 bin]# ll</span><br><span class="line">总用量 11572</span><br><span class="line">-rwxr-xr-x 1 root root  354024 10月 25 14:57 redis-benchmark</span><br><span class="line">-rwxr-xr-x 1 root root 3646760 10月 25 14:57 redis-check-aof</span><br><span class="line">-rwxr-xr-x 1 root root 3646760 10月 25 14:57 redis-check-rdb</span><br><span class="line">-rwxr-xr-x 1 root root  520296 10月 25 14:57 redis-cli</span><br><span class="line">lrwxrwxrwx 1 root root      12 10月 25 14:57 redis-sentinel -&gt; redis-server</span><br><span class="line">-rwxr-xr-x 1 root root 3646760 10月 25 14:57 redis-server</span><br></pre></td></tr></table></figure>
<h2 id="配置-Redis"><a href="#配置-Redis" class="headerlink" title="配置 Redis"></a><strong>配置 Redis</strong></h2><p><strong>建立文件夹</strong><br>/etc/redis 存放Redis的配置文件<br>/opt/redis-data/端口号    存放Redis的持久化文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 redis-4.0.11]# mkdir /etc/redis</span><br><span class="line">[root@ecs-a073 redis-4.0.11]# mkdir -p /opt/redis-data/6379</span><br></pre></td></tr></table></figure>
<p><strong>复制conf文件</strong><br>将redis安装目录中的redis.conf复制到/etc/redis中，然后重命名成端口号.conf  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 opt]# cd /opt/redis-4.0.11/</span><br><span class="line">[root@ecs-a073 redis-4.0.11]# cp redis.conf /etc/redis/</span><br><span class="line">[root@ecs-a073 redis-4.0.11]# cd /etc/redis/</span><br><span class="line">[root@ecs-a073 redis]# mv redis.conf 6379.conf</span><br></pre></td></tr></table></figure>
<p><strong>复制初始化脚本</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 redis]# cd /opt/redis-4.0.11/utils/</span><br><span class="line">[root@ecs-a073 utils]# cp redis_init_script /etc/init.d</span><br><span class="line">[root@ecs-a073 utils]# cd /etc/init.d/</span><br><span class="line">[root@ecs-a073 init.d]# mv redis_init_script redis_6379</span><br></pre></td></tr></table></figure>
<p><strong>修改 conf 文件</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 init.d]# cd /etc/redis/</span><br><span class="line">[root@ecs-a073 redis]# vim 6379.conf</span><br></pre></td></tr></table></figure>
<p>修改的内容：<br>bind 127.0.0.1 —&gt; bind 0.0.0.0<br>protected-mode yes —&gt; protected-mode no<br>daemonize no —&gt; daemonize yes<br>pidfile /var/run/redis_6379.pid 这个默认就可以<br>dir ./ —&gt; dir /opt/redis-data/6379<br>appendonly no —&gt; appendonly yes<br>requirepass foobared 若需要设置密码就把注释打开，改成你要设置的密码  </p>
<h2 id="设置开机启动redis"><a href="#设置开机启动redis" class="headerlink" title="设置开机启动redis"></a><strong>设置开机启动redis</strong></h2><p>编辑/etc/init.d/redis_6379文件，在#!/bin/bash 之后添加如下两行  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 redis]# vim /etc/init.d/redis_6379</span><br><span class="line"># chkconfig: 2345 10 90</span><br><span class="line"># description: redis_6379 service manage…</span><br></pre></td></tr></table></figure>
<p>将redis_6379放入linux启动管理体系中  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 redis]# chkconfig --add redis_6379</span><br></pre></td></tr></table></figure>
<p>查看redis_6379服务在各运行级状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 redis]# chkconfig --list redis_6379</span><br><span class="line"></span><br><span class="line">注意：该输出结果只显示 SysV 服务，并不包含原生 systemd 服务。SysV 配置数据可能被原生 systemd 配置覆盖。</span><br><span class="line">      如果您想列出 systemd 服务,请执行 &apos;systemctl list-unit-files&apos;。</span><br><span class="line">      欲查看对特定 target 启用的服务请执行</span><br><span class="line">      &apos;systemctl list-dependencies [target]&apos;。</span><br><span class="line"></span><br><span class="line">redis_6379     	0:关	1:关	2:开	3:开	4:开	5:开	6:关</span><br></pre></td></tr></table></figure>
<h2 id="启动关闭redis"><a href="#启动关闭redis" class="headerlink" title="启动关闭redis"></a><strong>启动关闭redis</strong></h2><p>现在可以使用/etc/init.d/redis_端口号 start来启动redis了  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 redis-data]# /etc/init.d/redis_6379 start</span><br><span class="line">[root@ecs-a073 redis-data]# /etc/init.d/redis_6379 stop</span><br></pre></td></tr></table></figure>
<p>上面的stop方法可以停止redis，但是考虑到 Redis 有可能正在将内存中的数据同步到硬盘中，强行终止 Redis 进程可能会导致数据丢失。正确停止Redis的方式应该是向Redis发送SHUTDOWN命令，方法为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-a073 ~]# redis-cli SHUTDOWN</span><br></pre></td></tr></table></figure>
<p>参考文档：<a href="http://www.azurew.com/9086.html" target="_blank" rel="noopener">http://www.azurew.com/9086.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ZhouJinliang</p>
              <p class="site-description motion-element" itemprop="description">devops k8s python java</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhouJinliang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
